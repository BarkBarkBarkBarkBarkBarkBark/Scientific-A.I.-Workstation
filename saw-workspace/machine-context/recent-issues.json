{
  "version": 1,
  "generatedAt": "2026-01-07T00:00:00Z",
  "scope": "dev-runtime",
  "summary": "Common issues observed during recent safe patch/apply and chat sessions.",
  "issues": [
    {
      "id": "patch_check_failed",
      "category": "patch_apply",
      "messagePattern": "error: corrupt patch at line",
      "severity": "high",
      "lastSeenHint": "during safe apply pre-check (git apply --check)",
      "examples": [
        "SafePatchError: {\"error\":\"patch_check_failed\", \"details\":\"error: corrupt patch at line 25\n\"}"
      ],
      "rootCauses": [
        "Malformed unified diff hunks (blank lines without a leading space)",
        "Diffs missing final newline or containing zero-width characters",
        "Indented ```diff blocks causing header lines not to start at column 1"
      ],
      "suggestedFixes": [
        "Normalize diffs: CRLFâ†’LF, strip zero-width chars, ensure trailing newline",
        "Inside hunks, turn empty lines into a single space context line",
        "Dedent fenced blocks and ensure diff headers start at column 1"
      ]
    },
    {
      "id": "invalid_diff_missing_headers",
      "category": "patch_apply",
      "severity": "medium",
      "examples": [
        "Patch must include --- / +++ headers (unified diff)."
      ],
      "suggestedFixes": [
        "Emit git-style headers: 'diff --git', '--- a/<path>', '+++ b/<path>'",
        "For new files: include 'new file mode', '--- /dev/null', '+++ b/<path>'"
      ]
    },
    {
      "id": "path_not_allowed",
      "category": "policy",
      "severity": "medium",
      "examples": [
        "safe.patch.reject: reason=path_not_allowed, allowlist=PATCH_APPLY_ALLOWLIST"
      ],
      "suggestedFixes": [
        "Restrict agent edits to allowed prefixes",
        "Adjust PATCH_APPLY_ALLOWLIST if broader edits are intended"
      ]
    },
    {
      "id": "forbidden_caps",
      "category": "policy",
      "severity": "medium",
      "examples": [
        "{ error: 'forbidden', op: 'safe_patch_write', path: '<file>' }",
        "{ error: 'forbidden', op: 'safe_patch_delete', path: '<file>' }"
      ],
      "suggestedFixes": [
        "Use /api/dev/caps to grant write/delete on targeted paths",
        "UI: click 'Enable Write' when prompted"
      ]
    },
    {
      "id": "validation_failed_build",
      "category": "post_apply_validation",
      "severity": "high",
      "examples": [
        "safe.patch.rollback: reason=validation_failed (npm run build output)",
        "safe.write.rollback: reason=validation_failed"
      ],
      "suggestedFixes": [
        "Keep changes minimal; run build locally before applying wider diffs",
        "Prefer isolated edits within allowed areas to avoid cascading errors"
      ]
    },
    {
      "id": "stale_todo_caching",
      "category": "ui_cache",
      "severity": "medium",
      "symptoms": [
        "Todo panel or chat sees old contents of saw-workspace/todo.md"
      ],
      "rootCauses": [
        "Missing no-store headers on dev JSON endpoints",
        "Frontend fetch() lacked cache: 'no-store'"
      ],
      "suggestedFixes": [
        "Set Cache-Control: no-store on dev responses",
        "Use fetch(..., { cache: 'no-store' }) for /api/dev/file and /api/dev/tree"
      ]
    },
    {
      "id": "chat_file_hallucination",
      "category": "chat_prompting",
      "severity": "high",
      "symptoms": [
        "Chat invents a pretty todo list despite attached file saying otherwise"
      ],
      "rootCauses": [
        "File contents not attached on follow-up messages",
        "System prompt did not mark FILE: blocks as authoritative"
      ],
      "suggestedFixes": [
        "Auto-attach todo.md for follow-up edit intents",
        "Add system guard: FILE:<path> blocks are the only source of truth"
      ]
    },
    {
      "id": "safari_localhost_connectivity",
      "category": "dev_server",
      "severity": "low",
      "symptoms": [
        "Safari fails to connect after patch apply/restart"
      ],
      "suggestedFixes": [
        "Run Vite with --host to expose dev server"
      ]
    },
    {
      "id": "recovery_rollback_lost_progress",
      "category": "crash_recovery",
      "severity": "medium",
      "symptoms": [
        "Progress appears lost after crash; 'saw:auto-pre' stashes exist"
      ],
      "rootCauses": [
        "Recovery rolled back to preHead but did not pop auto-pre stash"
      ],
      "suggestedFixes": [
        "On startup: if recovery indicates hadStash, pop it to restore uncommitted work",
        "Manually: git stash list; git stash pop"
      ]
    },
    {
      "id": "todo_missing_file",
      "category": "fs",
      "severity": "low",
      "symptoms": [
        "ENOENT when reading saw-workspace/todo.md"
      ],
      "suggestedFixes": [
        "Create the file before first read"
      ]
    }
  ]
}
